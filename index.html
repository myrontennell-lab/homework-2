<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Track & Field â€” A-Frame Scene</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <style>
      body { margin: 0; font-family: sans-serif; }
      .hint { position: absolute; left: 12px; top: 12px; z-index: 10; background: rgba(255,255,255,0.9); padding:8px; border-radius:6px; }
    </style>
  </head>
  <body>
    <div class="hint">
      <strong>Track & Field Demo</strong><br>
      Press <code>S</code> to start the race, <code>R</code> to reset.
    </div>

    <a-scene background="color: #87ceeb">
      <!-- Camera + cursor -->
      <a-entity id="cameraRig" position="0 2 12">
        <a-entity camera look-controls wasd-controls>
        </a-entity>
      </a-entity>

      <!-- Ground -->
      <a-plane rotation="-90 0 0" width="60" height="200" color="#3b7a57" position="0 0 0"></a-plane>

      <!-- Track base -->
      <a-box position="0 0.01 -50" depth="120" width="12" height="0.02" color="#9b2b2b"></a-box>

      <!-- Lane markings (6 lanes) -->
      <!-- Track coordinate: center at x=0, lanes spaced by 2 units -->
      <a-entity id="lanes">
        <a-box position="-5 0.02 -10" width="0.05" height="0.02" depth="120" color="#ffffff"></a-box>
        <a-box position="-3 0.02 -10" width="0.05" height="0.02" depth="120" color="#ffffff"></a-box>
        <a-box position="-1 0.02 -10" width="0.05" height="0.02" depth="120" color="#ffffff"></a-box>
        <a-box position="1 0.02 -10" width="0.05" height="0.02" depth="120" color="#ffffff"></a-box>
        <a-box position="3 0.02 -10" width="0.05" height="0.02" depth="120" color="#ffffff"></a-box>
        <a-box position="5 0.02 -10" width="0.05" height="0.02" depth="120" color="#ffffff"></a-box>
      </a-entity>

      <!-- Lane numbers at start -->
      <a-text value="1" color="#000" align="center" position="-5 0.2 20" scale="1 1 1"></a-text>
      <a-text value="2" color="#000" align="center" position="-3 0.2 20" scale="1 1 1"></a-text>
      <a-text value="3" color="#000" align="center" position="-1 0.2 20" scale="1 1 1"></a-text>
      <a-text value="4" color="#000" align="center" position="1 0.2 20" scale="1 1 1"></a-text>
      <a-text value="5" color="#000" align="center" position="3 0.2 20" scale="1 1 1"></a-text>
      <a-text value="6" color="#000" align="center" position="5 0.2 20" scale="1 1 1"></a-text>

      <!-- Starting blocks -->
      <a-entity id="startBlocks">
        <a-box position="-5 0.05 40" width="0.8" height="0.1" depth="0.4" color="#333"></a-box>
        <a-box position="-3 0.05 40" width="0.8" height="0.1" depth="0.4" color="#333"></a-box>
        <a-box position="-1 0.05 40" width="0.8" height="0.1" depth="0.4" color="#333"></a-box>
        <a-box position="1 0.05 40" width="0.8" height="0.1" depth="0.4" color="#333"></a-box>
        <a-box position="3 0.05 40" width="0.8" height="0.1" depth="0.4" color="#333"></a-box>
        <a-box position="5 0.05 40" width="0.8" height="0.1" depth="0.4" color="#333"></a-box>
      </a-entity>

      <!-- Finish line -->
      <a-entity id="finishLine" position="0 0.5 -50">
        <a-plane width="12" height="0.8" rotation="0 0 0" color="#ffffff" material="side:double"></a-plane>
        <!-- Black stripes -->
        <a-box position="-5.5 0 0" width="0.4" height="0.02" depth="1" color="#000"></a-box>
        <a-box position="-4.0 0 0" width="0.4" height="0.02" depth="1" color="#000"></a-box>
        <a-box position="-2.5 0 0" width="0.4" height="0.02" depth="1" color="#000"></a-box>
        <a-box position="-1.0 0 0" width="0.4" height="0.02" depth="1" color="#000"></a-box>
        <a-box position="0.5 0 0" width="0.4" height="0.02" depth="1" color="#000"></a-box>
        <a-box position="2.0 0 0" width="0.4" height="0.02" depth="1" color="#000"></a-box>
        <a-box position="3.5 0 0" width="0.4" height="0.02" depth="1" color="#000"></a-box>
        <a-box position="5.0 0 0" width="0.4" height="0.02" depth="1" color="#000"></a-box>
      </a-entity>

      <!-- Runners (simple colored capsules) -->
      <a-entity id="runners">
        <a-cylinder id="runner1" position="-5 0.5 40" radius="0.3" height="1" color="#ff4136"></a-cylinder>
        <a-cylinder id="runner2" position="-3 0.5 40" radius="0.3" height="1" color="#ff851b"></a-cylinder>
        <a-cylinder id="runner3" position="-1 0.5 40" radius="0.3" height="1" color="#2ecc40"></a-cylinder>
        <a-cylinder id="runner4" position="1 0.5 40" radius="0.3" height="1" color="#0074d9"></a-cylinder>
        <a-cylinder id="runner5" position="3 0.5 40" radius="0.3" height="1" color="#b10dc9"></a-cylinder>
        <a-cylinder id="runner6" position="5 0.5 40" radius="0.3" height="1" color="#ffdc00"></a-cylinder>
      </a-entity>

      <!-- Scoreboard text above camera -->
      <a-entity position="0 3 6">
        <a-text id="scoreboard" value="Press S to start the race" align="center" color="#000" width="6"></a-text>
      </a-entity>

      <!-- Lighting -->
      <a-entity light="type: ambient; color: #BBB"></a-entity>
      <a-entity light="type: directional; intensity: 0.7" position="-1 2 1"></a-entity>

      <!-- Simple sky -->
      <a-sky color="#87ceeb"></a-sky>

      <script>
        // Simple race controller
        (function () {
          const runners = [
            document.getElementById('runner1'),
            document.getElementById('runner2'),
            document.getElementById('runner3'),
            document.getElementById('runner4'),
            document.getElementById('runner5'),
            document.getElementById('runner6')
          ];

          const startZ = 40; // starting z position
          const finishZ = -50; // finish line z position
          let animating = false;
          let intervalId = null;

          function resetRunners() {
            runners.forEach((r, i) => {
              r.setAttribute('position', `${-5 + i*2} 0.5 ${startZ}`);
            });
            document.getElementById('scoreboard').setAttribute('value', 'Press S to start the race');
            animating = false;
            if (intervalId) { clearInterval(intervalId); intervalId = null; }
          }

          function startRace() {
            if (animating) return;
            animating = true;
            // Give each runner a random base speed
            const speeds = runners.map(() => 0.08 + Math.random() * 0.08); // units per tick

            document.getElementById('scoreboard').setAttribute('value', 'Race in progress...');

            intervalId = setInterval(() => {
              for (let i = 0; i < runners.length; i++) {
                const r = runners[i];
                const pos = r.getAttribute('position');
                const newZ = pos.z - speeds[i];
                r.setAttribute('position', `${pos.x} ${pos.y} ${newZ}`);

                // simple bobbing animation to simulate running
                const scaleY = 1 + 0.05 * Math.sin(Date.now() / 80 + i);
                r.setAttribute('scale', `1 ${scaleY} 1`);

                if (newZ <= finishZ) {
                  // we have a winner
                  clearInterval(intervalId);
                  intervalId = null;
                  animating = false;
                  const winnerIndex = i + 1;
                  document.getElementById('scoreboard').setAttribute('value', `Runner ${winnerIndex} wins! Press R to reset.`);
                  return;
                }
              }
            }, 40);
          }

          // Keyboard controls: S = start, R = reset
          window.addEventListener('keydown', (e) => {
            if (e.key.toLowerCase() === 's') startRace();
            if (e.key.toLowerCase() === 'r') resetRunners();
          });

          // initialize
          resetRunners();
        })();
      </script>
    </a-scene>
  </body>
</html>
